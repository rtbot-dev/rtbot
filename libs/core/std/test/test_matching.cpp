#include <catch2/catch.hpp>
#include <iostream>
#include <vector>

#include "rtbot/std/Matching.h"

using namespace rtbot;
using namespace std;

TEST_CASE("matching")
{
    SECTION("no condition")
    {
        vector<long> A={
            2070, 2634, 3202, 4070, 4602, 5487, 6118, 6723, 7305, 7891, 8452, 8996, 9538, 10081, 10654, 11294, 12094,
            12988, 13787, 14561, 15321, 16047, 16688, 17308, 17915, 18483, 19039, 19583, 20161, 20785, 21548, 22403,
            23158, 23892, 24568, 25233, 25852, 26452, 27035, 27579, 28150, 28703, 29247, 29776, 30364, 30955, 31570,
            32196, 32822, 33425, 34012, 34582, 35161, 35705, 36284, 36828, 37360, 37895, 38434, 38970, 39569, 40408,
            41242, 42129, 42951, 43711, 44434, 45086, 45695, 46281, 46845, 47438, 47979, 48551, 49085, 49601, 50139,
            50677, 51238, 51775, 52345, 52904, 53460, 54027, 54573, 55155, 55760, 56408, 57131, 57838, 58522, 59100,
            59679, 60233, 60764, 61301, 61828, 62356, 62876, 63385, 63886, 64363, 64939, 65411, 65885, 66384
        };
        vector<long> B={
            1326, 2041, 3421, 4495, 5452, 6696, 7850, 8970, 10063, 11290, 13760, 14527, 15280, 16018, 17284, 18445,
            19577, 20761, 21526, 22375, 23126, 23864, 25191, 26415, 27573, 28672, 29765, 30937, 32173, 33392, 34556,
            35690, 36779, 37862, 38948, 40378, 41229, 42090, 42911, 43666, 45054, 46246, 47401, 48516, 49581, 50652,
            51766, 52871, 53998, 55126, 56376, 57819, 59057, 60201, 61287, 62322
        };
        auto match=Matching(A,B);
        REQUIRE(match.matchA.size()==55);
        REQUIRE(match.matchA.size()==match.matchB.size());
        vector<long> sumA;
        merge(match.matchA.begin(),match.matchA.end(),
              match.extraA.begin(),match.extraA.end(),
              back_inserter(sumA));
        REQUIRE(sumA==A);

        vector<long> sumB;
        merge(match.matchB.begin(),match.matchB.end(),
              match.extraB.begin(),match.extraB.end(),
              back_inserter(sumB));
        REQUIRE(sumB==B);
    }


    SECTION("with condition")
    {
        vector<int> A={
            312, 425, 537, 649, 753, 852, 941, 1029, 1117, 1233, 1365, 1497, 1616, 1736, 1848, 1956, 2056, 2156, 2248, 2336,
            2424, 2516, 2632, 2764, 2888, 3012, 3132, 3244, 3351, 3458, 3558, 3650, 3742, 3842, 3954, 4071, 4193, 4314, 4433,
            4545, 4654, 4759, 4853, 4951, 5052, 5161, 5275, 5391, 5505, 5612, 5712, 5814, 5922, 6033, 6140, 6248, 6351, 6450,
            6545, 6637, 6740, 6859, 6975, 7091, 7207, 7314, 7414, 7510, 7606, 7698, 7786, 7878, 7974, 8097, 8221, 8345, 8461,
            8569, 8669, 8761, 8853, 8945, 9049, 9157, 9261, 9361, 9453, 9545, 9637, 9745, 9861, 9977, 10089, 10202, 10301,
            10393, 10481, 10569
        };
        vector<int> B={
            182, 292, 406, 515, 627, 733, 832, 921, 1011, 1100, 1213, 1348, 1475, 1599, 1717, 1829, 1936, 2037, 2137,
            2228, 2318, 2406, 2534, 2653, 2780, 2908, 2995, 3114, 3225, 3337, 3439, 3575, 3670, 3762, 3858, 3975, 4087,
            4219, 4447, 4604, 4870, 4968, 5068, 5178, 5291, 5407, 5521, 5628, 5732, 5836, 5943, 6050, 6158, 6265, 6371,
            6468, 6559, 6658, 6761, 6875, 6995, 7107, 7223, 7332, 7430, 7527, 7622, 7714, 7804, 7894, 7994, 8113, 8242,
            8360, 8482, 8590, 8685, 8776, 8869, 8965, 9068, 9174, 9277, 9377, 9471, 9561, 9657, 9760, 9877, 9995, 10107,
            10218, 10319, 10409, 10499, 10589, 10685
        };
        auto condition=[](int x,int y){return x>y; };
        auto match=Matching<int>(A,B,condition);
        vector<int> ea={2516, 3558, 4433, 4759, 4853};
        REQUIRE(match.extraA==ea);
        vector<int> eb={182, 2908, 10589, 10685};
        REQUIRE(match.extraB==eb);
    }

}
