load("@rules_cc//cc:defs.bzl", "cc_test")

exports_files(["tools.h"])

cc_test(
    name = "test",
    srcs = glob([
        "**/*.cpp",
        "**/*.h",
    ]),
    data = glob([
        "**/*.json",
        "**/*.csv",
    ]) + [
        "//examples/data:ppg.csv",
    ],
    #defines = ["CATCH_CONFIG_MAIN"],
    copts = [
        "-DCATCH_CONFIG_POSIX_SIGNALS",
        "-g",
        "-fsanitize=address",
        "-Wno-macro-redefined"
    ],
    linkopts = [
        "-fsanitize=address",
    ],
    deps = [
        "//libs/std:rtbot-std",
        "@catch2",
    ] + select({
        "//:enable_telemetry": [
            "@io_opentelemetry_cpp//api",
            "@io_opentelemetry_cpp//exporters/otlp:otlp_file_exporter",
            "@io_opentelemetry_cpp//sdk/src/trace",
        ],
        "//conditions:default": [],
    }),
)
